{% extends "layout.html" %}
{% block body %}
<head>

<script type="text/javascript" src="{{ url_for('static', filename='plotly-latest.min.js') }}"></script>

<script type=text/javascript src="{{ url_for('static', filename='jquery-3.0.0.min.js') }}"></script>
<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='Mystyle.css') }}">

<script type="text/javascript" src="{{ url_for('static', filename='html2canvas.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static',filename='canvas2image.js') }}"></script>

<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='jquery-ui.css') }}">
<script type="text/javascript" src="{{ url_for('static', filename='jquery-1.10.2.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='jquery-ui.js') }}"></script>

<style>
#new {
    width:17.5vw;
    height:3vh;
    line-height: 20px;
    margin: 4px 2px;
    border: 2px solid #AAA;
    border-radius: 4px;
    padding: 2px 4px;
    margin: 2px;
    background: #DDD;
    display: inline-block;
    text-align: center;
    text-decoration: none;
    color: black;

}
#new:hover {
    background: #CCC;
}
#new:active {
    background: #CCF;
}
#new :invalid + span {
    color: black;
}
#new :valid + span {
    color: black;
}


</style>
</head>

<script>
$(document).ready(function () {
    //$(document).addEventListener('change','input[type="file"]', function (e) {
    //alert("hi")
    $(document ).on('change','input[type="file"]', function () {
    var fullfilename=this.value;
    var filename = fullfilename.replace(/^.*[\\\/]/, '')
    document.getElementById("uploadFile").value = filename;
  });
});


$(document).ready(function() {
    var plot1 = $("#section1").find("*").toArray();
    var plot2 = $("#section2").find("*").toArray();
    var plot3 = $("#section3").find("*").toArray();
    var plot4 = $("#section4").find("*").toArray();



    $("#hide1").bind("click", function(){
        $("#section1").hide();
     });

    $("#hide2").bind("click", function(){
        $("#section2").hide();
     });

    $("#hide3").bind("click", function(){
        $("#section3").hide();
     });

    $("#hide4").bind("click", function(){
        $("#section4").hide();
     });


});

$(document).ready(function() {
         console.log("here")
    $("#clear").bind("click", function(){
         $("#section1").empty();
         $("#section2").empty();
         $("#section3").empty();
         $("#section4").empty();
         $( "#from_time" ).val("");
         $( "#to_time" ).val("");
         $( "#from_count" ).val("");
         $( "#to_count" ).val("");
         $( "#from_color1" ).val("");
         $( "#to_color1" ).val("");
         $( "#from_color2" ).val("");
         $( "#to_color2" ).val("");

        });
$(function() {

    $("#btnSave1").click(function() {
        html2canvas($("#section1"), {
            onrendered: function(canvas) {
                theCanvas = canvas;
                // Convert and download as image
                Canvas2Image.saveAsPNG(canvas);
                // Clean up
                //document.body.removeChild(canvas);
            }
        });
    });
    $("#btnSave2").click(function() {
        html2canvas($("#section2"), {
            onrendered: function(canvas) {
                theCanvas = canvas;
                // Convert and download as image
                Canvas2Image.saveAsPNG(canvas);
                // Clean up
                //document.body.removeChild(canvas);
            }
        });
    });
    $(window).resize(function() {
    var divheight = $("#section1").height();
    var divwidth = $("#section1").width();
    var update = {
      width:divwidth,
      height:divheight-20
    };
     var plot1 = $("#section1").find("*").toArray();
     var plot2 = $("#section2").find("*").toArray();
     var plot3 = $("#section3").find("*").toArray();
     var plot4 = $("#section4").find("*").toArray();
        Plotly.relayout(plot1[2].getAttribute("id"), update);
        Plotly.relayout(plot2[2].getAttribute("id"), update);
        Plotly.relayout(plot3[2].getAttribute("id"), update);
        Plotly.relayout(plot4[2].getAttribute("id"), update);

            }).resize();

var plotleft = $("#section1").find("*").toArray();
var plotright = $("#section2").find("*").toArray();

console.log(plotleft[2].getAttribute("id"))
console.log(plotright[2].getAttribute("id"))

var d3 = Plotly.d3;
var formatter = d3.format('.2f');


  document.getElementById(plotleft[2].getAttribute("id")).on('plotly_selected', (eventData) => {

  if(eventData) {
  var xRange = eventData.range.x;
  var yRange = eventData.range.y;
  $( "#from_time" ).val( xRange[ 0 ]);
  $( "#to_time" ).val(xRange[ 1 ] );
  $( "#from_count" ).val( yRange[ 0 ]);
  $( "#to_count" ).val(yRange[ 1 ] );
  /*Plotly.relayout(plotleft[2].getAttribute("id"), 'title',
`x range: [${xRange.map(formatter).join(', ')}]<br>
y range: [${yRange.map(formatter).join(', ')}]`
  );*/
}
 else {
    Plotly.relayout(plotleft[2].getAttribute("id") , 'title', '');
    $( "#from_time" ).val("");
    $( "#to_time" ).val("");
    $( "#from_count" ).val("");
    $( "#to_count" ).val("");
  }
  });

 document.getElementById(plotright[2].getAttribute("id")).on('plotly_selected', (eventData) => {
  if(eventData) {
  var xRange = eventData.range.x;
  var yRange = eventData.range.y;
  $( "#from_color1" ).val( xRange[ 0 ]);
  $( "#to_color1" ).val(xRange[ 1 ] );
  $( "#from_color2" ).val( yRange[ 0 ]);
  $( "#to_color2" ).val(yRange[ 1 ] );
  /*Plotly.relayout(plotleft[2].getAttribute("id"), 'title',
`x range: [${xRange.map(formatter).join(', ')}]<br>
y range: [${yRange.map(formatter).join(', ')}]`
  );*/
}
 else {
    Plotly.relayout(plotleft[2].getAttribute("id") , 'title', '');
    $( "#from_color1" ).val("");
    $( "#to_color1" ).val("");
    $( "#from_color2" ).val("");
    $( "#to_color2" ).val("");
  }

});


//For Left Plot
var  hoverInfoleft = document.getElementById('hoverinfoleft');
var plotleft = $("#section1").find("*").toArray();
document.getElementById(plotleft[2].getAttribute("id")).on('plotly_hover', function(data){
     var infotextforx = data.points.map(function(d){
      return ('x : '+d.x);
    });

     var infotextfory = data.points.map(function(d){
      return ('y : '+d.y.toPrecision(6));
    });

     var pt = data.points[0];
     var ptNumber = pt.pointNumber;
     var trace = pt.data;

     error_x_string= (trace.error_x.array[ptNumber]).toString();
     error_y_string= (trace.error_y.array[ptNumber]).toString();


     var spacesup= '\xa0\xa0\xa0\xa0\xa0\xa0\xa0' ;
     var spacesdown= '\xa0\xa0\xa0\xa0\xa0\xa0\xa0' ;


     hoverInfoleft.innerHTML = infotextforx +"+/-"  + error_x_string + spacesup + infotextfory + "+/-" + error_y_string;//+ "<br />";

}).on('plotly_unhover', function(data){
    hoverInfoleft.innerHTML = '';

});

//For Right Plot
var  hoverInforight = document.getElementById('hoverinforight');
var plotleft = $("#section2").find("*").toArray();
document.getElementById(plotright[2].getAttribute("id")).on('plotly_hover', function(data){
     var infotextforx = data.points.map(function(d){
      return ('x : '+d.x);
    });

     var infotextfory = data.points.map(function(d){
      return ('y : '+d.y.toPrecision(6));
    });

     var pt = data.points[0];
     var ptNumber = pt.pointNumber;
     var trace = pt.data;

     error_x_string= (trace.error_x.array[ptNumber]).toString();
     error_y_string=  (trace.error_y.array[ptNumber]).toString();

     var spacesup=  '\xa0\xa0\xa0\xa0\xa0\xa0\xa0' ;
     var spacesdown='\xa0\xa0\xa0\xa0\xa0\xa0\xa0' ;


      hoverInforight.innerHTML = infotextforx +"+/-"  + error_x_string + spacesup + infotextfory + "+/-" + error_y_string;

}).on('plotly_unhover', function(data){
    hoverInforight.innerHTML = '';

});


});
});


</script>

<script>
          //For time
         $(function() {
            $( "#slider-time" ).slider({
               range:true,
               min: {{start_time_slider| safe}},
               max:{{end_time_slider| safe}},
               //values: [0,0 ],
               slide: function( event, ui ) {
                  $( "#from_time" ).val( ui.values[ 0 ]);
                  $( "#to_time" ).val( ui.values[ 1 ] );
               }
           });
        // $( "#from_time" ).val($( "#slider-time" ).slider( "values", 0 )  );
         //$( "#to_time" ).val($( "#slider-time" ).slider( "values", 1 ) )
         });

         //For rate/count
        $(function() {
            $( "#slider-count" ).slider({
               range:true,
               min: {{start_count_slider| safe}},
               max:{{end_count_slider| safe}},
               //values: [0,0 ],
               slide: function( event, ui ) {
                  $( "#from_count" ).val( ui.values[ 0 ]);
                  $( "#to_count" ).val( ui.values[ 1 ] );
               }
           });
        // $( "#from_count" ).val($( "#slider-count" ).slider( "values", 0 )  );
        // $( "#to_count" ).val($( "#slider-count" ).slider( "values", 1 ) )
         });

         //For color1
         $(function() {
            $( "#slider-color1" ).slider({
               range:true,
               min: {{start_color1_slider| safe}},
               max: {{end_color1_slider| safe}},
               //values: [0, 0 ],
               slide: function( event, ui ) {
                  $( "#from_color1" ).val( ui.values[ 0 ]);
                  $( "#to_color1" ).val( ui.values[ 1 ] );
               }
           });
        // $( "#from_color1" ).val($( "#slider-color1" ).slider( "values", 0 )  );
        // $( "#to_color1" ).val($( "#slider-color1" ).slider( "values", 1 ) )
         });

         //For color2
          $(function() {
            $( "#slider-color2" ).slider({
               range:true,
               min: {{start_color2_slider| safe}},
               max: {{end_color2_slider| safe}},
               //values: [0, 0],
               slide: function( event, ui ) {
                  $( "#from_color2" ).val( ui.values[ 0 ]);
                  $( "#to_color2" ).val( ui.values[ 1 ] );
               }
           });
        // $( "#from_color2" ).val($( "#slider-color2" ).slider( "values", 0 ) );
        // $( "#to_color2" ).val($( "#slider-color2" ).slider( "values", 1 ) )
         });
      </script>

<div id="nav_index" >
<font size="3"><b>Current Filename<b></font>

<div class="mainselection">
<form action = "http://localhost:5000/uploader_index" method = "POST" enctype = "multipart/form-data">

<input id="uploadFile" placeholder="Choose File"  style="width:18.5vw" type="text" name="display_text" disabled="disabled" />
<p> <a href="/" id="new">Set File</a> </p>
</label>

  <font size="3"><b>Select Time Range<b></font><br>
     <input id="from_time" type="text" name="from_time" placeholder="From">
     <input id="to_time" type="text" name="to_time" placeholder="To" ><br>
    <div id="slider-time" style="width:18.5vw;"></div>

<br>

  <font size="3"><b>Select Count Rate Range<b></font>
  <br>
     <input id="from_count" type="text" name="from_count" placeholder="From">
     <input id="to_count" type="text" name="to_count" placeholder="To" ><br>
     <div id="slider-count" style="width:18.5vw;"></div>

<br>

<font size="3"><b>Select Color1 Range<b></font>
  <br>
      <input id="from_color1" type="text" name="from_color1" placeholder="From">
     <input id="to_color1" type="text" name="to_color1" placeholder="To" ><br>
     <div id="slider-color1" style="width:18.5vw;"></div>
<br>

  <font size="3"><b>Select Color2 Range<b></font>
  <br>
     <input id="from_color2" type="text" name="from_color2" placeholder="From">
     <input id="to_color2" type="text" name="to_color2" placeholder="To" ><br>
     <div id="slider-color2" style="width:18.5vw;"></div>
<br>

</div>
    <input type="submit" name="my-form" value="Load Spectrum">

    </form>
    <button id ="clear" class="button button1">Clear</button>
    <br><input type="button" id="btnSave1"  value="Save Left"/>
    <input type="button" id="btnSave2"  value="Save Right"/>
</div>


<div class="hello" id="section1" >

  {{div_placeholder_fig1| safe}}

<div style="float:right">
<button id="hide1">Hide</button>
</div>

  <script>
  var filename=  {{filename| safe}};
  document.getElementById("uploadFile").value = filename;
  </script>

<div>
<div id="hoverinfoleft" style="text-align:center;color:#1F77B4"> </div>
</div>

</div>


<div class="hello" id="section2" >

  {{div_placeholder_fig2| safe}}

<div style="float:right">
<button id="hide2">Hide</button>
</div>

  <script>
  var filename=  {{filename| safe}};
  document.getElementById("uploadFile").value = filename;
  </script>

<div>
<div id="hoverinfoleft" style="text-align:center;color:#1F77B4"> </div>
</div>

</div>




<div class="hello" id="section3" >

  {{div_placeholder_fig3| safe}}

<div style="float:right">
<button id="hide3">Hide</button>
</div>

  <script>
  var filename=  {{filename| safe}};
  document.getElementById("uploadFile").value = filename;
  </script>

<div>
<div id="hoverinfoleft" style="text-align:center;color:#1F77B4"> </div>
</div>

</div>


<div class="hello" id="section4" >

  {{div_placeholder_fig4| safe}}

<div style="float:right">
<button id="hide4">Hide</button>
</div>

  <script>
  var filename=  {{filename| safe}};
  document.getElementById("uploadFile").value = filename;
  </script>

<div>
<div id="hoverinfoleft" style="text-align:center;color:#1F77B4"> </div>
</div>

</div>

<div id="includedContent"></div>


<div id="footer">
DAVE
</div>


{% endblock %}
